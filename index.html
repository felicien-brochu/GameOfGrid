<html charset="UTF-8">
<head>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>
<body>
	<!-- Game canvas -->
	<canvas id="gog-game-of-life-canvas"></canvas>
	<canvas id="gog-shadow-canvas"></canvas>
	
	<!-- Settings controls -->
	<ul id="gog-action-buttons">
		<li><button id="gog-play-pause-button" class="gog-play-button"/></li>
		<li><button id="gog-reset-button"/></li>
		<li><button id="gog-next-pattern-button"/></li>
		<li><button id="gog-settings-button"/></li>
		<li><button id="gog-full-screen-button"/></li>
	</ul>
	<div id="gog-settings-panel">
		<table id="gog-sliders-container">
			<tr>
				<td>Speed</td>
				<td><div id="gog-speed-slider" class="gog-slider"></div></td>
			</tr>
			<tr>
				<td>Trace</td>
				<td><div id="gog-trace-slider" class="gog-slider"></div></td>
			</tr>
			<tr>
				<td>Color</td>
				<td><div id="gog-color-slider" class="gog-slider"></div></td>
			</tr>
		</table>
		
		<ul id="gog-symmetry-container">
			<li>
				<input id="gog-symmetry-none-radio" type="radio" name="symmetry" value="0" class="gog-symmetry-radio"/>
				<label for="gog-symmetry-none-radio"></label>
			</li>
			<li>
				<input id="gog-symmetry-vertical-radio" type="radio" name="symmetry" value="1" class="gog-symmetry-radio"/>
				<label for="gog-symmetry-vertical-radio"></label>
			</li>
			<li>
				<input id="gog-symmetry-horizontal-radio" type="radio" name="symmetry" value="2" class="gog-symmetry-radio"/>
				<label for="gog-symmetry-horizontal-radio"></label>
			</li>
			<li>
				<input id="gog-symmetry-double-radio" type="radio" name="symmetry" value="3" class="gog-symmetry-radio"/>
				<label for="gog-symmetry-double-radio"></label>
			</li>
			<li>
				<input id="gog-symmetry-central-radio" type="radio" name="symmetry" value="4" class="gog-symmetry-radio"/>
				<label for="gog-symmetry-central-radio"></label>
			</li>
		</ul>
		
		<ul id="gog-pattern-buttons">
			<li><button id="gog-cross-pattern-button"/></li>
			<li><button id="gog-gun-pattern-button"/></li>
			<li><button id="gog-random-pattern-button"/></li>
			<li><button id="gog-canvas-pattern-button"/></li>
		</ul>
		
	</div>
	
	<script type="text/javascript" src="js/gameoflife.js"></script>
	<script type="text/javascript" src="js/patterns.js"></script>
	<script type="text/javascript" src="js/settings.js"></script>
	<script type="text/javascript" src="js/slider.js"></script>
	<script type="text/javascript" src="js/fullscreen.js"></script>
	<script type="text/javascript" src="js/auto-hide.js"></script>
	
	<script id="vertex" type="x-shader">
		attribute vec2 aVertexPosition;
		
		void main() {
			gl_Position = vec4(aVertexPosition, 0.0, 1.0);
		}
	</script>
	
	<script id="fragment" type="x-shader">
		#ifdef GL_ES
		precision highp float;
		#endif

		uniform vec2 resolution; // width, height
		uniform float pixWidth;  // Width, in pixels
		uniform float pixHeight; // Height, in pixels
		uniform sampler2D cellColors;

		int modulo(float dividend, float diviser) {
			return int(dividend) - (int(dividend) / int(diviser) * int(diviser));
		}
		
		void main() {
			vec2 texSize = resolution;
			if (modulo(resolution.x, pixWidth) > 0) {
				texSize.x += pixWidth - mod(resolution.x, pixWidth);
			}
			if (modulo(resolution.y, pixHeight) > 0) {
				texSize.y = texSize.y + pixHeight - mod(resolution.y, pixHeight);
			}
			vec2 offset = vec2(gl_FragCoord.x, resolution.y - gl_FragCoord.y) - vec2(0.5, 0.5);
			
			if (modulo(offset.x, pixWidth) == 0 ||
				modulo(offset.y, pixWidth) == 0) {
				gl_FragColor = vec4(0.874, 0.874, 0.874, 1.0);
			} else {
				vec2 position = ((offset + vec2(0.0, 0.0)) / resolution) * (resolution / texSize);
				vec4 color = texture2D(cellColors, position);
				float alpha = color[3];
				float alphaGray = 1.0 - alpha;
				color = (color * vec4(alpha, alpha, alpha, 1.0)) + vec4(0.8 * alphaGray, 0.8 * alphaGray, 0.8 * alphaGray, alphaGray);
				gl_FragColor = color;
			}
		}
	</script>
	<script type="text/javascript">
		var gameOfLife = new GameOfLife();
		var settings = new Settings(gameOfLife);
		gameOfLife.registerSettings(settings);
		window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
	                                   window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
		function render() {
			gameOfLife.render.bind(gameOfLife)();
			requestAnimationFrame(render);
		};
		render();
	</script>

</body>
</html>