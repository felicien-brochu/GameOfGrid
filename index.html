<html charset="UTF-8">
<head>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>
<body>
	<!-- Game canvas -->
	<canvas id="gameOfLifeCanvas"></canvas>
	<canvas id="shadowCanvas"></canvas>
	
	<!-- Settings controls -->
	<ul id="actionButtons">
		<li><button id="playPauseButton" class="playButton"/></li>
		<li><button id="resetButton"/></li>
		<li><button id="nextPatternButton"/></li>
		<li><button id="settingsButton"/></li>
		<li><button id="fullscreenButton"/></li>
	</ul>
	<div id="settingsPanel">
		<table id="slidersContainer">
			<tr>
				<td>Speed</td>
				<td><div id="speedSlider" class="slider"></div></td>
			</tr>
			<tr>
				<td>Trace</td>
				<td><div id="traceSlider" class="slider"></div></td>
			</tr>
			<tr>
				<td>Color</td>
				<td><div id="colorSlider" class="slider"></div></td>
			</tr>
		</table>
	</div>
	
	<script type="text/javascript" src="js/gameoflife.js"></script>
	<script type="text/javascript" src="js/settings.js"></script>
	<script type="text/javascript" src="js/slider.js"></script>
	<script type="text/javascript" src="js/fullscreen.js"></script>
	<script type="text/javascript" src="js/cursor.js"></script>
	
	<script id="vertex" type="x-shader">
		attribute vec2 aVertexPosition;
		
		void main() {
			gl_Position = vec4(aVertexPosition, 0.0, 1.0);
		}
	</script>
	
	<script id="fragment" type="x-shader">
		#ifdef GL_ES
		precision highp float;
		#endif

		uniform vec2 resolution; // width, height
		uniform float pixWidth;  // Width, in pixels
		uniform float pixHeight; // Height, in pixels
		uniform sampler2D cellColors;

		int modulo(float dividend, float diviser) {
			return int(dividend) - (int(dividend) / int(diviser) * int(diviser));
		}
		
		void main() {
			vec2 texSize = resolution;
			if (modulo(resolution.x, pixWidth) > 0) {
				texSize.x += pixWidth - mod(resolution.x, pixWidth);
			}
			if (modulo(resolution.y, pixHeight) > 0) {
				texSize.y = texSize.y + pixHeight - mod(resolution.y, pixHeight);
			}
			vec2 offset = vec2(gl_FragCoord.x, resolution.y - gl_FragCoord.y) - vec2(0.5, 0.5);
			
			if (modulo(offset.x, pixWidth) == 0 ||
				modulo(offset.y, pixWidth) == 0) {
				gl_FragColor = vec4(0.874, 0.874, 0.874, 1.0);
			} else {
				vec2 position = ((offset + vec2(0.0, 0.0)) / resolution) * (resolution / texSize);
				vec4 color = texture2D(cellColors, position);
				float alpha = color[3];
				float alphaGray = 1.0 - alpha;
				color = (color * vec4(alpha, alpha, alpha, 1.0)) + vec4(0.8 * alphaGray, 0.8 * alphaGray, 0.8 * alphaGray, alphaGray);
				gl_FragColor = color;
			}
		}
	</script>
	<script type="text/javascript">
		var gameOfLife = new GameOfLife();
		var settings = new Settings(gameOfLife);
		gameOfLife.registerSettings(settings);
		window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
	                                   window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
		function render() {
			gameOfLife.render.bind(gameOfLife)();
			requestAnimationFrame(render);
		};
		render();
	</script>

</body>
</html>